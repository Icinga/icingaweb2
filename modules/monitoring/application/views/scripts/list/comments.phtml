<?php if (! $this->compact): ?>
<div class="controls">
  <?= $this->tabs; ?>
  <?= $this->sortBox; ?>
  <?= $this->limiter; ?>
  <?= $this->paginator; ?>
  <?= $this->filterEditor; ?>
</div>
<?php endif ?>
<div class="content">
<?php

if (count($comments) === 0) {
    echo $this->translate('No comments found matching the filter') . '</div>';
    return;
}
?>
  <table data-base-target="_next" class="action comments">
    <tbody>
    <?php foreach ($comments as $comment): ?>
    <?php
      switch ($comment->type) {
        case 'flapping':
          $icon = 'flapping';
          $title = $this->translate('Flapping');
          $tooltip = $this->translate('Comment was caused by a flapping host or service.');
          break;
        case 'comment':
          $icon = 'user';
          $title = $this->translate('User Comment');
          $tooltip = $this->translate('Comment was created by an user.');
          break;
        case 'downtime':
          $icon = 'plug';
          $title = $this->translate('Downtime');
          $tooltip = $this->translate('Comment was caused by a downtime.');
          break;
        case 'ack':
          $icon = 'ok';
          $title = $this->translate('Acknowledgement');
          $tooltip = $this->translate('Comment was caused by an acknowledgement.');
          break;
      }
    ?>
      <tr class="state invalid">
        <td class="state" style="width: 12em;">
          <?= $this->icon($icon, $tooltip) ?>
          <br>
          <strong><?= $this->escape($title); ?></strong>
          <br>
          <?= $this->prefixedTimeSince($comment->timestamp); ?>
        </td>
        <td>
        <?php if ($comment->objecttype === 'service'): ?>
          <?= $this->icon('service', $this->translate('Service')); ?>
          <?= $this->link()->service(
              $comment->service_description,
              $comment->service_display_name,
              $comment->host_name,
              $comment->host_display_name
          ); ?>
        <?php else: ?>
          <?= $this->icon('host', $this->translate('Host')); ?>
          <?= $this->link()->host($comment->host_name, $comment->host_display_name); ?>
        <?php endif ?>
          <br>
          <?= $this->icon('comment', $this->translate('Comment')); ?> <?= isset($comment->author)
            ? '[' . $comment->author . '] '
            : '';
          ?><?= $this->escape($comment->comment); ?>
          <br>
          <?= $comment->persistent
            ? $this->translate('This comment is persistent.')
            : $this->translate('This comment is not persistent.');
          ?>
          <br>
          <?= $comment->expiration ? sprintf(
              $this->translate('This comment expires on %s at %s.'),
              date('d.m.y', $comment->expiration),
              date('H:i', $comment->expiration)
            ) : $this->translate('This comment does not expire.'); ?>
        </td>
        <?php if (isset($delCommentForm)): // Form is unset if the current user lacks the respective permission ?>
        <td style="width: 2em" data-base-target="self">
          <?php
          $delCommentForm = clone $delCommentForm;
          $delCommentForm->populate(array('comment_id' => $comment->id, 'redirect' => $this->url));
          if ($comment->objecttype === 'host') {
            $delCommentForm->setAction(
                $this->url('monitoring/host/delete-comment', array('host' => $comment->host_name))
            );
          } else {
            $delCommentForm->setAction($this->url('monitoring/service/delete-comment', array(
                'host'      => $comment->host_name,
                'service'   => $comment->service_description
            )));
          }
          echo $delCommentForm;
          ?>
        </td>
        <?php endif ?>
      </tr>
<?php endforeach ?>
    </tbody>
  </table>
</div>
